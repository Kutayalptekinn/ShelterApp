@layout MainLayout
@page "/product"
@using ShelterApp.Business.Services.ProductService
@using ShelterApp.Components
@using ShelterApp.Components.Commons.Loadings
@using ShelterApp.Components.Layouts
@using ShelterApp.Entities.Entities.Product.dtos
@using ShelterApp.UI.Pages.Base


@inherits BaseListPage<SelectProductDto, ListProductDto, CreateProductDto, UpdateProductDto>

@inject IProductAppService ProductAppService
@inject NavigationManager NavigationManager


@if (!base.IsLoaded)
{
    <CircleLoading Caption="@base.LoadingCaption" Text="@base.LoadingText" />
}
else
{
    <DevGridLayout ColumnCount="1" RowCount="3" >
        <GridLayoutItems>
@*             <DxGridLayoutItem Row="0" Column="0" ColumnSpan="1">
                <Template>
                    <SfCard class="TSIListPageTitleCard">
                        <CardContent>
                            <BreadCrumb PreviousMenus="Product" CurrentMenu="Product Listesi" />
                        </CardContent>
                        <CardFooter>
                        </CardFooter>
                    </SfCard>
                </Template>
            </DxGridLayoutItem> *@
            <DxGridLayoutItem Row="2" Column="0" ColumnSpan="1">
                <Template>
                    <SfCard class="TSIGridCards">

                        <CardContent>
                            <SfGrid ID="Grid" @ref="_grid" AllowPdfExport=true ColumnMenuItems=@MenuItems ShowColumnMenu="true" DataSource="@ListDataSource" AllowPaging="@AllowGridPaging" AllowFiltering="true" AllowReordering="true" AllowResizing="true" AllowGrouping="true" AllowExcelExport="true" ShowColumnChooser="true" GridLines="GridLine.Both" AllowSelection="true" AllowSorting="true" Height="100%" Width="100%" class="GridZebra" Toolbar=@GridToolbarItems>

                                <GridEvents OnToolbarClick="@ToolbarClickHandler" TValue="ListProductDto"></GridEvents>

                                <GridGroupSettings ShowGroupedColumn="true"></GridGroupSettings>

                                <GridEditSettings AllowAdding="false" AllowEditing="false" AllowDeleting="false" Mode="Syncfusion.Blazor.Grids.EditMode.Normal"></GridEditSettings>

                                <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.Menu"></GridFilterSettings>

                                <GridPageSettings PageSizes="true" PageSize="@GridPageSize"></GridPageSettings>

                                <GridSelectionSettings Type="Syncfusion.Blazor.Grids.SelectionType.Multiple"></GridSelectionSettings>

                                <GridColumns>
                                    <GridColumn HeaderText="Sıra No" TextAlign="TextAlign.Left" Width="120">
                                        <Template Context="cntxt">
                                            @{
                                                var contxt = (cntxt as ListProductDto);
                                                var siraNo = ((ListDataSource.IndexOf(contxt) + 1).ToString());
                                            }
                                            @siraNo
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field=@nameof(ListProductDto.Baslik) HeaderText="Başlık" TextAlign="TextAlign.Left" Width="120"></GridColumn>

                                    <GridColumn Field=@nameof(ListProductDto.Foto) HeaderText="Resim" TextAlign="TextAlign.Left" Width="120">
                                        <Template>
                                            @{
                                                var imgBase = (context as ListProductDto).Foto;
                                            if (imgBase.Length > 0)
                                            {
                                                var base64 = Convert.ToBase64String(imgBase);
                                                var imgSrc = String.Format("data:image/jpg;base64,{0}", base64);
                                                @*<img src="@imgSrc" />*@

                                                    <div style="text-align:center;">
                                                        <img src="@imgSrc" style="width:75px;height:75px;" />
                                                    </div>
                                            }
                                            else
                                            {
                                                    <div style="text-align:center;">
                                                        <img src="" style="width:75px;height:75px;" />
                                                    </div>
                                                }
                                            }
                                        </Template>
                                    </GridColumn>
                                     <GridColumn Field="İşlemler" HeaderText="İşlemler" TextAlign="TextAlign.Left" Width="120">
                                        <Template>
                                            <button class="btn btn-success" @onclick="() => EditItem(context as ListProductDto)"><i class="fa fa-pen"></i></button>
                                            <button class="btn btn-danger" @onclick="() => DeleteItem(context as ListProductDto)"><i class="fa fa-trash"></i></button>
                                        </Template>
                                    </GridColumn>

                                </GridColumns>
                            </SfGrid>
                        </CardContent>
                        <CardFooter>
                        </CardFooter>
                    </SfCard>
                </Template>
            </DxGridLayoutItem>
        </GridLayoutItems>
    </DevGridLayout>

    <DxPopup @bind-Visible="base.EditPageVisible"
         ShowFooter="true"
         CloseOnEscape="false"
         CloseOnOutsideClick="false"
         HeaderText="Ürün Listesi"
         HeaderCssClass="HeaderTitleCss">

        <BodyTemplate>
            <DxGridLayout CssClass="TSIGridLayout">

                <Rows>
                    <DxGridLayoutRow Height="30%" />
                    <DxGridLayoutRow Height="40%" />
                    <DxGridLayoutRow Height="30%" />
                </Rows>

                <Columns>
                    <DxGridLayoutColumn Width="2%" />
                    <DxGridLayoutColumn Width="46%" />
                    <DxGridLayoutColumn Width="4%" />
                    <DxGridLayoutColumn Width="46%" />
                    <DxGridLayoutColumn Width="2%" />
                </Columns>

                <Items>
                    <DxGridLayoutItem Row="0" Column="1">
                        <Template>
                            <br />
                            <label class="TSIModalLabel"><strong>Başlık</strong></label><br />
                            <SfTextBox CssClass=" " @bind-Value="DataSource.Baslik"></SfTextBox>
                        </Template>
                    </DxGridLayoutItem> 
                     
                 

                     <DxGridLayoutItem Row="0" Column="3" >
                        <Template>
                            @{
                                var imgBase = DataSource.Foto;

                                if (imgBase != null && imgBase.Length > 0)
                                {
                                    var base64 = Convert.ToBase64String(imgBase);
                                    var imgSrc = String.Format("data:image/jpg;base64,{0}", base64);
                                    <br />
                                    <img src="@imgSrc" style="width:150px;height:150px;" />
                                }
                                else
                                {
                                    <br />
                                    <img src="images/resimYok.jpg" style="width:150px;height:150px;" />
                                }
                            }
                        </Template>
                    </DxGridLayoutItem>
                    <DxGridLayoutItem Row="2" Column="3">
                        <Template>
                            <br />
                            <div class="file-input-zone">
                                <InputFile OnChange="UploadFiles" />
                            </div>
                        </Template>
                    </DxGridLayoutItem>


           






                </Items>
            </DxGridLayout>


        </BodyTemplate>
        <FooterContentTemplate>
            <SfButton CssClass="SaveButton" OnClick="OnSubmit"><SfIcon Size="IconSize.Medium" Name="IconName.Save"></SfIcon>&nbsp;Kaydet</SfButton>
            <SfButton CssClass="CancelButton" OnClick="HideEditPage"><SfIcon Size="IconSize.Medium" Name="IconName.Undo"></SfIcon>&nbsp;Kapat</SfButton>
        </FooterContentTemplate>
    </DxPopup>
}